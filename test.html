<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mobile 90Â° Rotation Corrected</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  body, html { margin:0; padding:0; width:100%; height:100%; font-family: Arial; }
  svg { width:100vw; height:100vh; }
  .bar { fill: steelblue; fill-opacity:0.8; }
  .bar:hover { fill-opacity:1; }
  .line { fill:none; stroke:orange; stroke-width:3px; }
  .dot { fill:orange; }
</style>
</head>
<body>
<svg></svg>

<script>
const svg = d3.select("svg");
const margin = {top:60, right:60, bottom:60, left:80};

function drawChart() {
  svg.selectAll("*").remove();
  const width = window.innerWidth - margin.left - margin.right;
  const height = window.innerHeight - margin.top - margin.bottom;

  const chartGroup = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

  d3.csv("data.csv", d=>({
    Minute: d["Minute"].trim(),
    Power: +d["Power"].trim(),
    Nominal: +d["Nominal"].trim()
  })).then(rawData => {
    const grouped = d3.groups(rawData, d=>d.Minute);
    const data = grouped.map(([minute, rows])=>({
      Minute: minute,
      Power: d3.mean(rows,r=>r.Power),
      Nominal: +rows[0].Nominal
    }));

    // Function to detect if the user is on a mobile device
    function isMobileDevice() {
        return !!/Mobi|Android|iPhone|iPad|iPod/.test(navigator.userAgent);
    }

    if (!isMobileDevice()) {
      // Desktop horizontal chart
      const x = d3.scaleBand().domain(data.map(d=>d.Minute)).range([0,width]).padding(0.2);
      const y = d3.scaleLinear().domain([0,d3.max(data,d=>Math.max(d.Power,d.Nominal))*1.1]).nice().range([height,0]);

      chartGroup.append("g").attr("transform",`translate(0,${height})`).call(d3.axisBottom(x));
      chartGroup.append("g").call(d3.axisLeft(y));

      chartGroup.selectAll(".bar")
        .data(data).join("rect")
          .attr("class","bar")
          .attr("x",d=>x(d.Minute))
          .attr("y",d=>y(d.Power))
          .attr("width",x.bandwidth())
          .attr("height",d=>height - y(d.Power));

      const line = d3.line()
        .x(d=>x(d.Minute)+x.bandwidth()/2)
        .y(d=>y(d.Nominal))
        .curve(d3.curveMonotoneX);

      chartGroup.append("path").datum(data).attr("class","line").attr("d",line);
      chartGroup.selectAll(".dot")
        .data(data).join("circle")
          .attr("class","dot")
          .attr("cx",d=>x(d.Minute)+x.bandwidth()/2)
          .attr("cy",d=>y(d.Nominal))
          .attr("r",5);

    } else {
      // Mobile: rotate chart 90deg clockwise correctly
      // Rotate around bottom-left of chart area
      const rotatedGroup = svg.append("g")
        .attr("transform", `translate(${margin.left},${margin.top + height}) rotate(-90)`);

      // Swap scales: x = Minute, y = Power/Nominal
      const x = d3.scaleBand().domain(data.map(d=>d.Minute)).range([0,height]).padding(0.2);
      const y = d3.scaleLinear().domain([0,d3.max(data,d=>Math.max(d.Power,d.Nominal))*1.1]).nice().range([0,width]);

      // Axes (inside rotated group)
      rotatedGroup.append("g").call(d3.axisLeft(y));
      rotatedGroup.append("g").attr("transform",`translate(0,${width})`).call(d3.axisBottom(x));

      // Bars
      rotatedGroup.selectAll(".bar")
        .data(data).join("rect")
          .attr("class","bar")
          .attr("y",d=>x(d.Minute))
          .attr("x",0)
          .attr("height",x.bandwidth())
          .attr("width",d=>y(d.Power));

      // Line
      const line = d3.line()
        .x(d=>y(d.Nominal))
        .y(d=>x(d.Minute)+x.bandwidth()/2)
        .curve(d3.curveMonotoneY);

      rotatedGroup.append("path").datum(data).attr("class","line").attr("d",line);

      // Dots
      rotatedGroup.selectAll(".dot")
        .data(data).join("circle")
          .attr("class","dot")
          .attr("cx",d=>y(d.Nominal))
          .attr("cy",d=>x(d.Minute)+x.bandwidth()/2)
          .attr("r",5);
    }
  });
}

drawChart();
window.addEventListener("resize", drawChart);
</script>
</body>
</html>
