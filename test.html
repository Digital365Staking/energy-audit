<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mobile 90Â° Rotated Chart</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  body, html { margin:0; padding:0; width:100%; height:100%; font-family: Arial; }
  svg { width:100vw; height:100vh; }
  .bar { fill: steelblue; fill-opacity:0.8; }
  .bar:hover { fill-opacity:1; }
  .line { fill:none; stroke:orange; stroke-width:3px; }
  .dot { fill:orange; }
</style>
</head>
<body>
<svg></svg>

<script>
const svg = d3.select("svg");
const margin = {top:60, right:60, bottom:60, left:80};

function drawChart() {
  svg.selectAll("*").remove();
  const width = window.innerWidth - margin.left - margin.right;
  const height = window.innerHeight - margin.top - margin.bottom;

  d3.csv("data.csv", d=>({
    Minute: d["Minute"].trim(),
    Power: +d["Power"].trim(),
    Nominal: +d["Nominal"].trim()
  })).then(rawData => {
    const grouped = d3.groups(rawData, d=>d.Minute);
    const data = grouped.map(([minute, rows])=>({
      Minute: minute,
      Power: d3.mean(rows,r=>r.Power),
      Nominal: +rows[0].Nominal
    }));

    // Function to detect if the user is on a mobile device
    function isMobileDevice() {
        return !!/Mobi|Android|iPhone|iPad|iPod/.test(navigator.userAgent);
    }

    if (!isMobileDevice()) {
      // Desktop horizontal chart
      const chartGroup = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
      const x = d3.scaleBand().domain(data.map(d=>d.Minute)).range([0,width]).padding(0.2);
      const y = d3.scaleLinear().domain([0,d3.max(data,d=>Math.max(d.Power,d.Nominal))*1.1]).nice().range([height,0]);

      chartGroup.append("g").attr("transform",`translate(0,${height})`).call(d3.axisBottom(x));
      chartGroup.append("g").call(d3.axisLeft(y));

      chartGroup.selectAll(".bar")
        .data(data).join("rect")
          .attr("class","bar")
          .attr("x",d=>x(d.Minute))
          .attr("y",d=>y(d.Power))
          .attr("width",x.bandwidth())
          .attr("height",d=>height - y(d.Power));

      const line = d3.line()
        .x(d=>x(d.Minute)+x.bandwidth()/2)
        .y(d=>y(d.Nominal))
        .curve(d3.curveMonotoneX);

      chartGroup.append("path").datum(data).attr("class","line").attr("d",line);
      chartGroup.selectAll(".dot")
        .data(data).join("circle")
          .attr("class","dot")
          .attr("cx",d=>x(d.Minute)+x.bandwidth()/2)
          .attr("cy",d=>y(d.Nominal))
          .attr("r",5);

    } else {
         const rotatedGroup = svg.append("g")
          .attr("transform", `translate(${fullWidth},0) rotate(90)`);

          // Scales: X = Power/Nominal (horizontal), Y = Minute (vertical)
          const xRot = d3.scaleLinear()
              .domain([0, d3.max(data, d => Math.max(d.Power, d.Nominal)) * 1.1])
              .range([0, width]); // horizontal axis
        
          const yRot = d3.scaleBand()
              .domain(data.map(d => d.Minute))
              .range([0, height])
              .padding(0.2); // vertical axis
        
          const chartGroup = rotatedGroup.append("g")
              .attr("transform", `translate(${margin.left},${margin.top})`);
        
          // Axes
          chartGroup.append("g").call(d3.axisTop(xRot)); // horizontal axis (Power)
          chartGroup.append("g").call(d3.axisLeft(yRot)); // vertical axis (Minute)
        
          // Bars
          chartGroup.selectAll(".bar")
            .data(data)
            .join("rect")
              .attr("class", "bar")
              .attr("x", 0)               // start from left
              .attr("y", d => yRot(d.Minute)) // vertical position along new Y
              .attr("width", d => xRot(d.Power)) // horizontal growth along new X
              .attr("height", yRot.bandwidth());
        
          // Line
          const line = d3.line()
              .x(d => xRot(d.Nominal))
              .y(d => yRot(d.Minute) + yRot.bandwidth()/2)
              .curve(d3.curveMonotoneY);
        
          chartGroup.append("path").datum(data).attr("class","line").attr("d",line);
        
          // Dots
          chartGroup.selectAll(".dot")
            .data(data)
            .join("circle")
              .attr("class","dot")
              .attr("cx", d => xRot(d.Nominal))
              .attr("cy", d => yRot(d.Minute) + yRot.bandwidth()/2)
              .attr("r", 5);
    }
  });
}

drawChart();
window.addEventListener("resize", drawChart);
</script>
</body>
</html>
